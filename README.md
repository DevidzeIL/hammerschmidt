# VetPlast - Каталог товаров с калькулятором и админкой

Production-ready MVP для каталога полимерных материалов с калькулятором цен и системой заявок.

## Технологии

- **Next.js 14** (App Router) + TypeScript
- **Prisma** + PostgreSQL
- **shadcn/ui** + TailwindCSS
- **NextAuth** для админ-авторизации
- **nodemailer** для отправки заявок
- **Docker Compose** для продакшена

## Быстрый старт

### Локальная разработка (без установки PostgreSQL)

**Важно:** Убедитесь, что Docker Desktop запущен перед выполнением команд ниже.

1. Запустите PostgreSQL в Docker:
```bash
pnpm db:up
```
или
```bash
docker compose -f docker-compose.dev.yml up -d
```

Если Docker Desktop не запущен, вы получите ошибку подключения. Просто запустите Docker Desktop и повторите команду.

2. Установите зависимости:
```bash
pnpm install
```

3. Создайте `.env` файл:
```bash
cp .env.example .env
```

Отредактируйте `.env` и укажите:
- `DATABASE_URL=postgresql://vetplast:vetplast123@localhost:5432/vetplast?schema=public` (уже настроено для Docker)
- `NEXTAUTH_SECRET` - секретный ключ (можно сгенерировать: `openssl rand -base64 32`)
- `ADMIN_EMAIL` и `ADMIN_PASSWORD` - учетные данные админа
- Настройки SMTP для отправки email (опционально для начала)

4. Запустите миграции и seed:
```bash
pnpm prisma:generate
pnpm prisma:migrate
pnpm prisma:seed
```

5. Запустите dev-сервер:
```bash
pnpm dev
```

Приложение будет доступно по адресу http://localhost:5000

**Управление базой данных:**
- `pnpm db:up` - запустить PostgreSQL
- `pnpm db:down` - остановить PostgreSQL
- `pnpm db:reset` - очистить данные и перезапустить (начать с чистого листа)

### Production (Docker Compose)

1. Создайте `.env` файл с необходимыми переменными (см. `.env.example`)

2. Запустите контейнеры:
```bash
docker compose up -d --build
```

Приложение будет доступно по адресу http://localhost:3000

## Команды

### Разработка
- `docker compose -f docker-compose.dev.yml up -d` - запуск PostgreSQL для разработки
- `pnpm dev` - запуск dev-сервера
- `pnpm prisma:migrate` - применение миграций
- `pnpm prisma:seed` - заполнение БД тестовыми данными
- `pnpm prisma:studio` - открыть Prisma Studio (GUI для БД)

### Production
- `pnpm build` - сборка для production
- `pnpm start` - запуск production-сервера
- `docker compose up -d --build` - запуск всего через Docker (PostgreSQL + Next.js)

## Структура проекта

```
app/
  (public)/          # Публичная часть сайта
    page.tsx         # Главная страница
    catalog/         # Каталог товаров
    cart/            # Корзина и калькулятор
    contacts/        # Контакты
    about/           # О компании
  admin/             # Админ-панель
    login/           # Страница входа
    products/        # Управление товарами
    requests/        # Управление заявками
  api/               # API endpoints
    products/        # CRUD товаров
    inquiries/       # CRUD заявок
    auth/            # NextAuth
components/
  ui/                # shadcn/ui компоненты
  storefront/        # Компоненты для публичной части
lib/                 # Утилиты и хелперы
  db.ts             # Prisma client
  pricing.ts        # Логика расчета цен
  validators.ts     # Zod схемы
  mailer.ts         # Отправка email
prisma/
  schema.prisma     # Схема БД
  seed.ts           # Seed данные
```

## Функциональность

### Публичная часть

- **Главная страница**: Hero секция, преимущества, CTA
- **Каталог**: Список товаров с поиском и фильтрацией
- **Карточка товара**: Детальная информация, ценовые диапазоны, добавление в корзину
- **Корзина**: Калькулятор цен по диапазонам, форма заявки
- **Контакты**: Информация о компании, реквизиты
- **О компании**: Описание компании

### Админ-панель

- **Авторизация**: Вход через NextAuth (Credentials provider)
- **Дашборд**: Статистика по товарам и заявкам
- **Управление товарами**: CRUD товаров, ценовых диапазонов, изображений
- **Управление заявками**: Просмотр, фильтрация, изменение статуса

## Модель данных

- **Product**: Товары с названием, описанием, slug, характеристиками
- **ProductImage**: Изображения товаров (URL)
- **ProductPriceTier**: Ценовые диапазоны (minQty, maxQty, pricePerUnit)
- **Inquiry**: Заявки от клиентов с контактами и списком товаров

## Безопасность

- Middleware защищает все админ-роуты (кроме `/admin/login`)
- Валидация данных через Zod на сервере
- Хеширование пароля админа через bcrypt (опционально)
- Обработка ошибок в API endpoints

## Загрузка изображений

Изображения можно загружать двумя способами:
1. **Загрузка файла** - файл сохраняется локально в `public/uploads/` с автоматической оптимизацией
2. **Вставка URL** - можно указать ссылку на внешнее изображение

### Автоматическая оптимизация

При загрузке файла изображения автоматически оптимизируются:
- **Максимальный размер**: 1920x1920px (изображения большего размера уменьшаются)
- **Формат**: конвертация в WebP для лучшего сжатия (GIF сохраняются как есть для сохранения анимации)
- **Качество**: 85% (баланс между качеством и размером файла)
- **Результат**: обычно уменьшение размера файла на 60-80% без заметной потери качества

Пример: изображение 4K (3840x2160, ~5MB) → оптимизированное (1920x1080, ~200-500KB)

## Лицензия

MIT
